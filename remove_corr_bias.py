# read_corr_bias.py
# Gerard Ruiz Carregal, Microwave Remote Sensing Lab, University of Massachusetts
# July 10, 2015
# Yang Lei, Jet Propulsion Labortary, California Institute of Technology
# May 18, 2017

# This script removes the correlation bias associated with ROI_PAC

#!/usr/bin/python
from numpy import *
from scipy.interpolate import interp1d
from scipy.stats import gamma
from mpmath import *

# Define remove_corr_bias function
# Input parameter is the correlation magnitude
def remove_corr_bias(C,L):
    
    # Set m and D arrays that correspond to ROI_PAC. In Matlab these values can be created using the hypergeom function.
##    L = 20.0
    k = 1.0
    D = double(arange(0,1,0.01))
    m=array([])
    for i in range(D.shape[0]):
        m=append(m,gamma(L)*gamma(1+k/2)/gamma(L+k/2)*hyper([1+k/2,L,L],[L+k/2,1],D[i]**2)*(1-D[i]**2)**L)
    m=double(m)
    p=arange(0,min(m),0.01)
    p=double(p)
    m=append(append(p, m), array([1]))
    D=append(append(0*p, D), array([1]))

############ L = 20
##    m = array([0,	0.0100000000000000,	0.0200000000000000,	0.0300000000000000,	0.0400000000000000,	0.0500000000000000,	0.0600000000000000,	0.0700000000000000,	0.0800000000000000,	0.0900000000000000,	0.100000000000000,	0.110000000000000,	0.120000000000000,	0.130000000000000,	0.140000000000000,	0.150000000000000,	0.160000000000000,	0.170000000000000,	0.180000000000000,	0.190000000000000,	0.199408653447441,	0.199593431047758,	0.200147282267063,	0.201068766333835,	0.202355495153146,	0.204004152905887,	0.206010523116798,	0.208369522828524,	0.211075243426613,	0.214120997576284,	0.217499371657278,	0.221202283019465,	0.225221041330094,	0.229546413244366,	0.234168689604869,	0.239077754362538,	0.244263154412164,	0.249714169548619,	0.255419881775459,	0.261369243234450,	0.267551142071870,	0.273954465613922,	0.280568160287925,	0.287381287796574,	0.294383077128001,	0.301562972062976,	0.308910673920755,	0.316416179365309,	0.324069813172351,	0.331862255933457,	0.339784566745224,	0.347828200997875,	0.355985023437906,	0.364247316732665,	0.372607785810390,	0.381059558287111,	0.389596181321441,	0.398211615259937,	0.406900224449403,	0.415656765598606,	0.424476374070988,	0.433354548482458,	0.442287133965194,	0.451270304440144,	0.460300544218525,	0.469374629226912,	0.478489608122279,	0.487642783533505,	0.496831693635148,	0.506054094228383,	0.515307941473766,	0.524591375391155,	0.533902704214634,	0.543240389664584,	0.552603033175837,	0.561989363100009,	0.571398222882038,	0.580828560195530,	0.590279417008657,	0.599749920542263,	0.609239275073939,	0.618746754536293,	0.628271695854041,	0.637813492962750,	0.647371591451690,	0.656945483774253,	0.666534704971231,	0.676138828855032,	0.685757464606072,	0.695390253736261,	0.705036867378246,	0.714697003862957,	0.724370386551807,	0.734056761893503,	0.743755897678905,	0.753467581470533,	0.763191619186178,	0.772927833818757,	0.782676064276796,	0.792436164332003,	0.802208001662135,	0.811991456978933,	0.821786423232219,	0.831592804882375,	0.841410517234378,	0.851239485827500,	0.861079645875351,	0.870930941751639,	0.880793326517616,	0.890666761487417,	0.900551215828244,	0.910446666192296,	0.920353096377970,	0.930270497017979,	0.940198865292195,	0.950138204663629,	0.960088524635429,	0.970049840527715,	0.980022173272741,	0.990005549227078,	1])
##    D = array([0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0,	0.0100000000000000,	0.0200000000000000,	0.0300000000000000,	0.0400000000000000,	0.0500000000000000,	0.0600000000000000,	0.0700000000000000,	0.0800000000000000,	0.0900000000000000,	0.100000000000000,	0.110000000000000,	0.120000000000000,	0.130000000000000,	0.140000000000000,	0.150000000000000,	0.160000000000000,	0.170000000000000,	0.180000000000000,	0.190000000000000,	0.200000000000000,	0.210000000000000,	0.220000000000000,	0.230000000000000,	0.240000000000000,	0.250000000000000,	0.260000000000000,	0.270000000000000,	0.280000000000000,	0.290000000000000,	0.300000000000000,	0.310000000000000,	0.320000000000000,	0.330000000000000,	0.340000000000000,	0.350000000000000,	0.360000000000000,	0.370000000000000,	0.380000000000000,	0.390000000000000,	0.400000000000000,	0.410000000000000,	0.420000000000000,	0.430000000000000,	0.440000000000000,	0.450000000000000,	0.460000000000000,	0.470000000000000,	0.480000000000000,	0.490000000000000,	0.500000000000000,	0.510000000000000,	0.520000000000000,	0.530000000000000,	0.540000000000000,	0.550000000000000,	0.560000000000000,	0.570000000000000,	0.580000000000000,	0.590000000000000,	0.600000000000000,	0.610000000000000,	0.620000000000000,	0.630000000000000,	0.640000000000000,	0.650000000000000,	0.660000000000000,	0.670000000000000,	0.680000000000000,	0.690000000000000,	0.700000000000000,	0.710000000000000,	0.720000000000000,	0.730000000000000,	0.740000000000000,	0.750000000000000,	0.760000000000000,	0.770000000000000,	0.780000000000000,	0.790000000000000,	0.800000000000000,	0.810000000000000,	0.820000000000000,	0.830000000000000,	0.840000000000000,	0.850000000000000,	0.860000000000000,	0.870000000000000,	0.880000000000000,	0.890000000000000,	0.900000000000000,	0.910000000000000,	0.920000000000000,	0.930000000000000,	0.940000000000000,	0.950000000000000,	0.960000000000000,	0.970000000000000,	0.980000000000000,	0.990000000000000,	1])

############ L = 30
##    m = array([ 0.        ,  0.01      ,  0.02      ,  0.03      ,  0.04      ,        0.05      ,  0.06      ,  0.07      ,  0.08      ,  0.09      ,        0.1       ,  0.11      ,  0.12      ,  0.13      ,  0.14      ,        0.15      ,  0.16      ,  0.16247771,  0.16270936,  0.16340336,        0.16455687,  0.1661652 ,  0.16822186,  0.17071866,  0.1736458 ,        0.17699201,  0.18074469,  0.18489002,  0.18941321,  0.19429856,        0.19952972,  0.20508983,  0.21096168,  0.21712789,  0.22357108,        0.23027397,  0.23721957,  0.24439125,  0.2517729 ,  0.25934896,        0.26710456,  0.2750255 ,  0.28309839,  0.2913106 ,  0.29965031,        0.30810653,  0.31666905,  0.32532847,  0.33407615,  0.34290419,        0.35180539,  0.36077321,  0.36980173,  0.37888562,  0.38802005,        0.39720072,  0.40642373,  0.41568562,  0.42498328,  0.43431392,        0.44367508,  0.45306451,  0.46248023,  0.47192047,  0.48138361,        0.49086822,  0.50037302,  0.50989683,  0.51943862,  0.52899742,        0.53857238,  0.5481627 ,  0.55776769,  0.56738669,  0.57701911,        0.58666441,  0.59632208,  0.60599167,  0.61567277,  0.62536499,        0.63506797,  0.64478139,  0.65450495,  0.66423837,  0.6739814 ,        0.6837338 ,  0.69349535,  0.70326585,  0.71304512,  0.72283299,        0.73262931,  0.74243391,  0.75224669,  0.7620675 ,  0.77189624,        0.78173282,  0.79157713,  0.80142908,  0.81128862,  0.82115565,        0.83103012,  0.84091198,  0.85080117,  0.86069765,  0.87060137,        0.88051231,  0.89043044,  0.90035573,  0.91028816,  0.92022771,        0.93017438,  0.94012815,  0.95008903,  0.960057  ,  0.97003208,        0.98001427,  0.99000357,  1.        ])
##    D = array([ 0.  ,  0.  ,  0.  ,  0.  ,  0.  ,  0.  ,  0.  ,  0.  ,  0.  ,                0.  ,  0.  ,  0.  ,  0.  ,  0.  ,  0.  ,  0.  ,  0.  ,  0.  ,                0.01,  0.02,  0.03,  0.04,  0.05,  0.06,  0.07,  0.08,  0.09,                0.1 ,  0.11,  0.12,  0.13,  0.14,  0.15,  0.16,  0.17,  0.18,                0.19,  0.2 ,  0.21,  0.22,  0.23,  0.24,  0.25,  0.26,  0.27,                0.28,  0.29,  0.3 ,  0.31,  0.32,  0.33,  0.34,  0.35,  0.36,                0.37,  0.38,  0.39,  0.4 ,  0.41,  0.42,  0.43,  0.44,  0.45,                0.46,  0.47,  0.48,  0.49,  0.5 ,  0.51,  0.52,  0.53,  0.54,                0.55,  0.56,  0.57,  0.58,  0.59,  0.6 ,  0.61,  0.62,  0.63,                0.64,  0.65,  0.66,  0.67,  0.68,  0.69,  0.7 ,  0.71,  0.72,                0.73,  0.74,  0.75,  0.76,  0.77,  0.78,  0.79,  0.8 ,  0.81,                0.82,  0.83,  0.84,  0.85,  0.86,  0.87,  0.88,  0.89,  0.9 ,                0.91,  0.92,  0.93,  0.94,  0.95,  0.96,  0.97,  0.98,  0.99,  1.  ])

    # Run interpolation
    set_interp = interp1d(m, D, kind='cubic')
    YC = set_interp(C)

    return YC
